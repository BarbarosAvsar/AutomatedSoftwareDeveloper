name: Unified Actions

on:
  push:
    branches: [main, master]
    tags:
      - "v*"
    paths-ignore:
      - "docs/**"
      - "**/*.md"
      - "newsfragments/**"
  pull_request:
    branches: [main, master]
    paths-ignore:
      - "docs/**"
      - "**/*.md"
  schedule:
    - cron: "30 2 * * *"
    - cron: "0 3 * * *"
    - cron: "0 4 * * 0"
    - cron: "0 5 * * 2"
    - cron: "0 6 * * 1"
    - cron: "0 7 * * 0"
  workflow_dispatch:
    inputs:
      profile:
        description: "CI profile"
        required: true
        default: fast
        type: choice
        options:
          - fast
          - full
          - security-only
          - release-candidate

permissions:
  actions: read
  attestations: write
  contents: read
  id-token: write
  issues: write
  pull-requests: write
  security-events: write

concurrency:
  group: unified-actions-${{ github.ref }}
  cancel-in-progress: true

env:
  PYTHON_FAST: "3.12"

jobs:
  workflow_lint:
    if: ${{ github.event_name != 'schedule' || github.event.schedule == '0 3 * * *' }}
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: ${{ env.PYTHON_FAST }}
          cache: pip
          cache-dependency-path: |
            pyproject.toml
            requirements*.txt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e .[dev,security]
      - name: Workflow lint
        run: python -m automated_software_developer.cli ci lint-workflows

  fast_checks:
    if: ${{ github.event_name == 'pull_request' || (github.event_name == 'workflow_dispatch' && inputs.profile == 'fast') }}
    runs-on: ubuntu-latest
    timeout-minutes: 30
    needs: workflow_lint
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: ${{ env.PYTHON_FAST }}
          cache: pip
          cache-dependency-path: |
            pyproject.toml
            requirements*.txt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e .[dev,security]
          python -m pip install pytest-repeat pytest-xdist pyright vulture
      - name: Ruff lint
        run: python -m ruff check .
      - name: Ruff format check
        run: python -m ruff format --check .
      - name: Type check (mypy)
        run: python -m mypy automated_software_developer
      - name: Type check (pyright, non-blocking baseline)
        continue-on-error: true
        run: pyright automated_software_developer
      - name: Import cycle check
        run: python scripts/detect_import_cycles.py
      - name: Dead code analysis (informational)
        run: |
          mkdir -p artifacts
          vulture automated_software_developer --min-confidence 90 --sort-by-size > artifacts/vulture-report.txt || true
      - name: Upload dead code report
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02
        with:
          name: vulture-fast
          path: artifacts/vulture-report.txt

  test_shard:
    if: ${{ (github.event_name != 'schedule' || github.event.schedule == '0 3 * * *') && (github.event_name != 'workflow_dispatch' || inputs.profile != 'security-only') }}
    needs: workflow_lint
    strategy:
      fail-fast: false
      matrix:
        shard_index: [0, 1, 2]
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: ${{ env.PYTHON_FAST }}
          cache: pip
          cache-dependency-path: |
            pyproject.toml
            requirements*.txt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e .[dev,security]
      - name: Run shard tests with coverage
        run: |
          mkdir -p artifacts
          SHARD_FILES=$(python scripts/select_test_shard.py ${{ matrix.shard_index }} 3)
          python -m pytest --cov=automated_software_developer --cov-fail-under=0 --cov-report=xml:artifacts/coverage-${{ matrix.shard_index }}.xml --junitxml=artifacts/junit-${{ matrix.shard_index }}.xml $SHARD_FILES
      - name: Upload shard artifacts
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02
        with:
          name: test-shard-${{ matrix.shard_index }}
          path: artifacts/
      - name: Upload shard diagnostics on failure
        if: ${{ failure() }}
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02
        with:
          name: shard-diagnostics-${{ matrix.shard_index }}
          path: |
            .pytest_cache
            artifacts

  coverage_guard:
    if: ${{ github.event_name == 'pull_request' }}
    needs: test_shard
    runs-on: ubuntu-latest
    timeout-minutes: 40
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: ${{ env.PYTHON_FAST }}
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e .[dev,security]
      - name: Compare coverage with base branch
        run: python scripts/check_coverage_diff.py "${{ github.base_ref }}"

  full_matrix_checks:
    if: ${{ github.event_name == 'schedule' && github.event.schedule == '0 3 * * *' || github.event_name == 'push' || (github.event_name == 'workflow_dispatch' && (inputs.profile == 'full' || inputs.profile == 'release-candidate')) }}
    needs: workflow_lint
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        python-version: ["3.11", "3.12", "3.13"]
    runs-on: ${{ matrix.os }}
    continue-on-error: ${{ matrix.python-version == '3.13' }}
    timeout-minutes: 45
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: ${{ matrix.python-version }}
          cache: pip
          cache-dependency-path: |
            pyproject.toml
            requirements*.txt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e .[dev,security]
      - name: Full checks
        run: |
          python -m ruff check .
          python -m ruff format --check .
          python -m mypy automated_software_developer
          python -m pytest --cov-fail-under=79

  security_linux:
    if: ${{ github.event_name != 'schedule' || github.event.schedule == '0 3 * * *' }}
    needs: workflow_lint
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
        with:
          fetch-depth: 0
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: ${{ env.PYTHON_FAST }}
          cache: pip
          cache-dependency-path: |
            pyproject.toml
            requirements*.txt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e .[dev,security]
      - name: Pip audit
        run: python -m pip_audit --progress-spinner off
      - name: Bandit JSON
        run: |
          python -m bandit -c bandit.yaml -r automated_software_developer -f json -o bandit.json
      - name: Convert Bandit JSON to SARIF
        run: |
          python scripts/bandit_json_to_sarif.py --input bandit.json --output bandit.sarif
      - name: Upload Bandit SARIF
        uses: github/codeql-action/upload-sarif@33119e582d3ab4ed79c2610af108cb08ff983917
        with:
          sarif_file: bandit.sarif
      - name: Gitleaks scan
        uses: gitleaks/gitleaks-action@dcedce43c6f43de0b836d1fe38946645c9c638dc
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  cli_smoke:
    if: ${{ github.event_name != 'schedule' || github.event.schedule == '0 3 * * *' }}
    needs: workflow_lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: ${{ env.PYTHON_FAST }}
      - run: |
          python -m pip install --upgrade pip
          python -m pip install -e .[dev]
      - name: CLI smoke checks
        run: python -m pytest tests/test_cli_smoke.py -q --no-cov

  coverage_report:
    if: ${{ github.event_name == 'pull_request' }}
    needs: test_shard
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@d3f86a106a0bac45b974a628896c90dbdf5c8093
        with:
          pattern: test-shard-*
          path: artifacts
      - name: Coverage summary
        id: cov
        run: |
          python - <<'PY'
          from pathlib import Path
          import xml.etree.ElementTree as ET
          rates = []
          for xml in Path('artifacts').rglob('coverage-*.xml'):
              root = ET.parse(xml).getroot()
              rates.append(float(root.attrib.get('line-rate', '0')) * 100.0)
          avg = sum(rates)/len(rates) if rates else 0.0
          print(f"average_coverage={avg:.2f}")
          with open('summary.txt','w',encoding='utf-8') as fh:
              fh.write(f"Average shard coverage: {avg:.2f}%\n")
          with open(Path.cwd() / '.github_step_summary_tmp','w',encoding='utf-8') as fh:
              fh.write(f"## Coverage\n- Average shard coverage: **{avg:.2f}%**\n")
          PY
          cat .github_step_summary_tmp >> "$GITHUB_STEP_SUMMARY"
          echo "value=$(cat summary.txt)" >> "$GITHUB_OUTPUT"
      - name: Upload coverage summaries
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02
        with:
          name: coverage-summary
          path: |
            artifacts
            summary.txt
      - name: Comment coverage on PR
        uses: actions/github-script@f28e40c7f34bde8b3046d885e986cb6290c5673b
        with:
          script: |
            const body = `CI coverage summary: ${{ steps.cov.outputs.value }}`;
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body
            });

  aggregate_required:
    if: ${{ always() && (github.event_name != 'schedule' || github.event.schedule == '0 3 * * *') }}
    needs:
      - workflow_lint
      - fast_checks
      - test_shard
      - coverage_guard
      - coverage_report
      - security_linux
      - cli_smoke
    runs-on: ubuntu-latest
    steps:
      - name: Check required job statuses
        run: |
          python - <<'PY'
          import json
          import os
          needs = json.loads(os.environ['NEEDS'])
          allowed = {'success', 'skipped'}
          bad = {k:v['result'] for k,v in needs.items() if v['result'] not in allowed}
          if bad:
              raise SystemExit(f"Required jobs failed: {bad}")
          print('All required checks passed or skipped')
          PY
        env:
          NEEDS: ${{ toJson(needs) }}

  self_diagnosis:
    if: ${{ failure() && (github.event_name != 'schedule' || github.event.schedule == '0 3 * * *') }}
    needs: [workflow_lint, fast_checks, test_shard, security_linux]
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: ${{ env.PYTHON_FAST }}
      - name: Environment diagnostics
        run: |
          uname -a
          python -V
          python -m pip -V
          python -m pip list
          git --version

  default_branch_failure_tracker:
    if: ${{ always() && (github.ref_name == 'main' || github.ref_name == 'master') && github.event_name == 'push' && needs.aggregate_required.result == 'failure' }}
    needs: aggregate_required
    runs-on: ubuntu-latest
    steps:
      - name: Open/update tracking issue
        uses: actions/github-script@f28e40c7f34bde8b3046d885e986cb6290c5673b
        with:
          script: |
            const title = 'Default branch CI failing';
            const runUrl = `${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}`;
            const body = `CI failed on default branch.\n\nWorkflow: ${context.workflow}\nRun: ${runUrl}\nHead SHA: ${context.sha}`;
            const issues = await github.rest.issues.listForRepo({owner: context.repo.owner, repo: context.repo.repo, state: 'open'});
            const existing = issues.data.find((issue) => issue.title === title);
            if (existing) {
              await github.rest.issues.createComment({owner: context.repo.owner, repo: context.repo.repo, issue_number: existing.number, body});
            } else {
              await github.rest.issues.create({owner: context.repo.owner, repo: context.repo.repo, title, body, labels: ['ci']});
            }

  codeql_analyze:
    if: ${{ github.event_name == 'pull_request' || github.event_name == 'push' || (github.event_name == 'schedule' && github.event.schedule == '0 4 * * 0') }}
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: github/codeql-action/init@33119e582d3ab4ed79c2610af108cb08ff983917
        with:
          languages: python
      - uses: github/codeql-action/autobuild@33119e582d3ab4ed79c2610af108cb08ff983917
      - uses: github/codeql-action/analyze@33119e582d3ab4ed79c2610af108cb08ff983917

  dependency_review:
    if: ${{ github.event_name == 'pull_request' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/dependency-review-action@46a3c492319c890177366b6ef46d6b4f89743ed4
        with:
          fail-on-severity: moderate
          deny-licenses: GPL-2.0, GPL-3.0, AGPL-1.0, AGPL-3.0

  docs_link_check:
    if: ${{ github.event_name == 'pull_request' || github.event_name == 'push' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: lycheeverse/lychee-action@a8c4c7cb88f0c7386610c35eb25108e448569cb0
        with:
          fail: true
          args: --verbose --no-progress './**/*.md'

  enforce_pinned_actions:
    if: ${{ github.event_name == 'pull_request' || github.event_name == 'push' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: "3.12"
      - name: Validate workflow action pinning
        run: python scripts/validate_workflow_pins.py

  flaky_detector:
    if: ${{ github.event_name == 'workflow_dispatch' || (github.event_name == 'schedule' && github.event.schedule == '0 5 * * 2') }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: "3.12"
      - run: |
          python -m pip install -U pip
          python -m pip install -e .[dev]
          python -m pip install pytest-repeat
      - name: Run repeated tests
        id: repeat
        run: |
          set +e
          python -m pytest -q --count 5 tests/test_cli_smoke.py tests/test_ci_mirror.py > flaky.log 2>&1
          status=$?
          echo "status=$status" >> "$GITHUB_OUTPUT"
          exit 0
      - name: Upload flaky logs
        if: ${{ steps.repeat.outputs.status != '0' }}
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02
        with:
          name: flaky-test-log
          path: flaky.log
      - name: Open issue on flakiness
        if: ${{ steps.repeat.outputs.status != '0' }}
        uses: actions/github-script@f28e40c7f34bde8b3046d885e986cb6290c5673b
        with:
          script: |
            const title = 'Flaky test detector found instability';
            const body = `Scheduled flaky-test detector observed failures.\n\nRun: ${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}`;
            const issues = await github.rest.issues.listForRepo({owner: context.repo.owner, repo: context.repo.repo, state: 'open'});
            const existing = issues.data.find((issue) => issue.title === title);
            if (existing) {
              await github.rest.issues.createComment({owner: context.repo.owner, repo: context.repo.repo, issue_number: existing.number, body});
            } else {
              await github.rest.issues.create({owner: context.repo.owner, repo: context.repo.repo, title, body, labels: ['ci', 'flaky']});
            }

  nightly_upstream:
    if: ${{ github.event_name == 'workflow_dispatch' || (github.event_name == 'schedule' && github.event.schedule == '30 2 * * *') }}
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: "3.12"
          cache: pip
          cache-dependency-path: |
            pyproject.toml
            requirements*.txt
      - name: Install latest dependencies
        run: |
          python -m pip install -U pip setuptools wheel
          python -m pip install -U -e .[dev,security]
      - name: Run full checks against latest dependency graph
        run: |
          python -m ruff check .
          python -m ruff format --check .
          python -m mypy automated_software_developer
          python -m pytest
          python -m pip_audit --progress-spinner off

  pr_auto_label:
    if: ${{ github.event_name == 'pull_request' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/labeler@8558fd74291d67161a8a78ce36a881fa63b766a9
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}

  pr_governance:
    if: ${{ github.event_name == 'pull_request' }}
    runs-on: ubuntu-latest
    needs: pr_auto_label
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
        with:
          fetch-depth: 0
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: "3.12"
      - name: Validate PR governance
        run: python scripts/check_pr_governance.py
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_LABELS: ${{ join(github.event.pull_request.labels.*.name, ',') }}
          BASE_REF: origin/${{ github.base_ref }}

  release_build_and_publish:
    if: ${{ github.event_name == 'push' && startsWith(github.ref, 'refs/tags/v') }}
    runs-on: ubuntu-latest
    permissions:
      contents: write
      id-token: write
      attestations: write
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: "3.12"
      - run: |
          python -m pip install -U pip
          python -m pip install -e .[dev,security]
          python -m pip install build cyclonedx-bom
      - name: Final gates
        run: |
          python -m ruff check .
          python -m ruff format --check .
          python -m mypy automated_software_developer
          python -m pytest
      - name: Build wheel and sdist
        run: python -m build
      - name: Generate SBOM
        run: |
          mkdir -p dist
          cyclonedx-py environment --output-format json --output-file dist/sbom.cdx.json
      - name: Attest build provenance
        uses: actions/attest-build-provenance@92c65d2898f1f53cfdc910b962cecff86e7f8fcc
        with:
          subject-path: dist/*
      - name: Upload release assets
        uses: softprops/action-gh-release@a06a81a03ee405af7f2048a818ed3f03bbf83c7b
        with:
          files: |
            dist/*
      - name: Publish to PyPI
        if: ${{ env.PYPI_API_TOKEN != '' }}
        env:
          PYPI_API_TOKEN: ${{ secrets.PYPI_API_TOKEN }}
        uses: pypa/gh-action-pypi-publish@81e9d935c883d0b210363ab89cf05f3894778450

  mutation_testing:
    if: ${{ github.event_name == 'workflow_dispatch' || (github.event_name == 'schedule' && github.event.schedule == '0 6 * * 1') }}
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: "3.12"
      - run: |
          python -m pip install -U pip
          python -m pip install -e .[dev]
          python -m pip install mutmut
      - name: Run mutmut (non-blocking)
        run: |
          mkdir -p artifacts/mutmut
          mutmut run || true
          mutmut html || true
          cp -r htmlcov artifacts/mutmut/html || true
      - name: Upload mutation report
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02
        with:
          name: mutation-report
          path: artifacts/mutmut

  workflow_self_test:
    if: ${{ github.event_name == 'pull_request' || (github.event_name == 'schedule' && github.event.schedule == '0 7 * * 0') }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: reviewdog/action-actionlint@3981d83a3cc805ac1bf47f53ffea3bb1d9171259
        with:
          fail_level: error

  collect_action_errors:
    if: ${{ always() }}
    needs:
      - workflow_lint
      - fast_checks
      - test_shard
      - coverage_guard
      - full_matrix_checks
      - security_linux
      - cli_smoke
      - coverage_report
      - aggregate_required
      - self_diagnosis
      - default_branch_failure_tracker
      - codeql_analyze
      - dependency_review
      - docs_link_check
      - enforce_pinned_actions
      - flaky_detector
      - nightly_upstream
      - pr_auto_label
      - pr_governance
      - release_build_and_publish
      - mutation_testing
      - workflow_self_test
    runs-on: ubuntu-latest
    steps:
      - name: Build unified failure report
        uses: actions/github-script@f28e40c7f34bde8b3046d885e986cb6290c5673b
        with:
          script: |
            const jobs = await github.paginate(github.rest.actions.listJobsForWorkflowRun, {
              owner: context.repo.owner,
              repo: context.repo.repo,
              run_id: context.runId,
              per_page: 100,
            });

            const failing = jobs.filter((job) => ['failure', 'timed_out', 'cancelled', 'action_required'].includes(job.conclusion));

            const lines = [];
            lines.push(`Workflow: ${context.workflow}`);
            lines.push(`Run URL: ${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}`);
            lines.push(`Commit: ${context.sha}`);
            lines.push('');

            if (failing.length === 0) {
              lines.push('No job failures detected.');
            } else {
              lines.push('Failed job summary:');
              for (const job of failing) {
                lines.push(`- ${job.name} (${job.conclusion})`);
                lines.push(`  ${job.html_url}`);
                const failedSteps = (job.steps || []).filter(
                  (step) => ['failure', 'timed_out', 'cancelled', 'action_required'].includes(step.conclusion),
                );
                if (failedSteps.length === 0) {
                  lines.push('  Steps: no failed step details available from API.');
                } else {
                  lines.push('  Steps:');
                  for (const step of failedSteps) {
                    lines.push(`    - ${step.name} (${step.conclusion})`);
                  }
                }
              }
            }

            const report = `${lines.join('\n')}\n`;
            core.setOutput('report', report);
            core.summary
              .addHeading('Unified Action Error Report')
              .addCodeBlock(report)
              .write();

            require('fs').writeFileSync('unified-action-error-report.txt', report, 'utf8');

      - name: Upload unified failure report
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02
        with:
          name: unified-action-error-report
          path: unified-action-error-report.txt
