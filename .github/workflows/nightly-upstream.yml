name: Nightly Upstream Dependency Check

on:
  schedule:
    - cron: "30 2 * * *"
  workflow_dispatch:

permissions:
  contents: read

jobs:
  nightly-latest-deps:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065
        with:
          python-version: "3.12"
          cache: pip
          cache-dependency-path: |
            pyproject.toml
            requirements*.txt
      - name: Install latest dependencies
        run: |
          python -m pip install -U pip setuptools wheel
          python -m pip install -U -e .[dev,security]
      - name: Run full checks against latest dependency graph
        run: |
          python -m ruff check .
          python -m ruff format --check .
          python -m mypy automated_software_developer
          python -m pytest
          python -m pip_audit --progress-spinner off
